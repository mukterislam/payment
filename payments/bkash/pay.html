<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <meta name="keywords" content="Bangladeshi Payment Gateway,DBBL Nexsus, VISA, Master, Amex, American Express, qCash, bKash" />
      <meta name="description" content="Secure Paymnet gateway" />
      <meta name="author" content="aamarPay Payment Gateway" />
      <link rel="icon" href="/images/logo/b.png" sizes="32x32" />
      <link rel="icon" href="/images/logo/b.png" sizes="192x192" />
      <link rel="apple-touch-icon-precomposed" href="b.png" />
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous" />
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
      <link rel="stylesheet" href="stylesheet.css" />
      <link rel="stylesheet" href="utils.css" />
      <link rel="stylesheet" href="style.css" />
      <link href="https://fonts.maateen.me/solaiman-lipi/font.css" rel="stylesheet" />
      <link rel="stylesheet" href="toastr.min.css" />
      <meta name="robots" content="noindex, nofollow">
      <title>SecureCheckout | Bohudur</title>
   </head>
   <body>
      <div class="container aa_sec">
         <div class="row">
            <div class="col-12 offset-0 col-lg-6 offset-lg-3">
               <div align="center">
                  <div class="card body-card">
                     <div align="center">
                        <div class="logo">
                           <a href="#" title="Bohudur">
                              <div class="ratio img-responsive img-circle" style="background-image: url('https://i.ibb.co.com/xHWCm5P/muk.png');"></div>
                           </a>
                        </div>
                     </div>
                     <div class="card-body prl-0 pb-0">
                        <div id="main_body">
                           <div class="mbdiv">
                              <div class="centerize">
                                 <div class="payment_ty">
                                    <img src="" alt="" id="acc" />
                                    <div class="flex_info" style="border-top: 7px solid #e2136e;">
                                       <img src="bkash.png" alt="" />
                                       <div class="info text-left">
                                          <h3>bKash Personal</h3>
                                          <p id="trans">Payment: Mukter</p>
                                       </div>
                                       <h3 id="am"></h3>
                                    </div>
                                 </div>
                                 <div class="input_step_confirm" style="background-color: #e2136e;">
                                    <ul class="all_step">
                                       <li class="li_row">
                                          <p class="text-left">*247# ডায়াল করে আপনার BKASH অ্যাপে অথবা BKASH মোবাইল মেনুতে যান।</p>
                                       </li>
                                       <hr />
                                       <li class="li_row">
                                          <p><span class="marked_text">"Send Money"</span> -এ ক্লিক করুন।</p>
                                       </li>
                                       <hr />
                                       <li class="li_row">
                                          <p class="text-left">
                                             এই নম্বরটি প্রাপক নম্বর হিসেবে লিখুনঃ
                                             <span id="number_label" class="marked_text">01900000890</span>
                                             <a href="01715712941" onclick="copyURI(event)" id="reply_copy">
                                             <img src="copy.png" class="w-3 inline mr-2" alt="Copy" />
                                             Copy
                                             </a>
                                          </p>
                                       </li>
                                       <hr />
                                       <li class="li_row">
                                          <p class="text-left">মোট টাকার পরিমাণঃ <span id="amount2" class="marked_text"></span></p>
                                       </li>
                                       <hr />
                                       <li class="li_row">
                                          <p>
                                             নিশ্চিত করতে এখন আপনার BKASH পিন লিখুন।
                                          </p>
                                       </li>
                                    </ul>
                                    <p id="titless">ট্রান্সজেকশন আইডি দিন</p>
                                    <div id="flexs">
                                       <input type="text" placeholder="ট্রান্সজেকশন আইডি দিন" id="transaction_id" autocomplete="off" maxlength="15" required />
                                    </div>
                                 </div>
                                 <div class="btn_action" style="background-color: #e2136e;">
                                    <button style="outline: none;" onclick="goBack()">CANCEL</button>
                                    <button style="outline: none;" id="submit_done" onclick="submit()">CONFIRM</button>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <img class="pt-20" src="bgl.png" width="40%" />
                  <br />
                  <p class="mb-5" style="color: white; font-size: 12px; padding-top: 5px;">
                     © Copyright 2023 Bohudur. All Rights Reserved
                     <br />
                  </p>
               </div>
            </div>
         </div>
      </div>
      <div id="aa_particles"></div>
      <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
      <script type="text/javascript" src="particle.js"></script>
      <script type="text/javascript" src="functions.js"></script>
      <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-app.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-database.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-auth.js"></script>
      <script>
         function getParameterByName(name, url) {
             if (!url) url = window.location.href;
             name = name.replace(/[\[\]]/g, "\\$&");
             var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                 results = regex.exec(url);
             if (!results) return null;
             if (!results[2]) return "";
             return decodeURIComponent(results[2].replace(/\+/g, " "));
         }
         
         var amount = getParameterByName("amount") || "0";
         
         function setPaymentDetails() {
             var amountElement = document.getElementById("am");
             var amountElement2 = document.getElementById("amount2");
             amountElement.innerText = "৳ " + amount;
             amountElement2.innerText = amount + ".00";
             var number_set = document.getElementById("number_label");
             number_set.textContent = getParameterByName("bkash_number") || "0000";
             var numberElement = document.getElementById("reply_copy");
             numberElement.href = getParameterByName("bkash_number") || "0000";
         }
         
         setPaymentDetails();
         
         function copyURI(evt) {
             evt.preventDefault();
             navigator.clipboard.writeText(evt.target.getAttribute("href")).then(
                 () => {
                     document.querySelector("#reply_copy").innerHTML = "<img src='copy.png' class='w-3 inline mr-2' alt='Copy'> Copied";
                 },
                 () => {}
             );
         }
         
         function goBack() {
             window.history.back();
         }
         
         function submit() {
         var transactionIdInput = document.getElementById("transaction_id");
         var transactionId = transactionIdInput.value.trim();
           
         var method = "bKash";
         
         if (transactionId === "") {
         swal("Error", "Transaction ID cannot be empty", "error");
         return;
         }
         
         if (transactionId.length < 6) {
         swal("Error", "Invalid Transaction ID. Please enter at least 6 characters", "error");
         return;
         }
         
         swal({
         title: "Loading",
         text: "Verifying transaction...",
         buttons: false,
         closeOnClickOutside: false,
         closeOnEsc: false,
         icon: "info",
         });
         
         getData();
         }

       function dataOfPayment(bohudurData, transaction_id2, dividerKey) {
            try {
                var paymentsData = bohudurData[dividerKey];
                try {
                    var paymentData = '';
                    var gatewayValue = '';
                    var amountValue = '';

                    for (var key in paymentsData) {
                        var innerObject = paymentsData[key];

                        if (innerObject.hasOwnProperty(transaction_id2)) {
                            var paymentKey = key;
                            var paymentInfo = innerObject[transaction_id2];
                            paymentInfo.paymentKey = paymentKey;
                            gatewayValue = paymentInfo.Gateway;
                            amountValue = paymentInfo.Amount;
                            paymentData = JSON.stringify(paymentInfo);
                            break;
                        }
                    }
                    
                    if(paymentData == ''){
                      swal("Failed!", "Payment Not Found", "error");
                    }else{
                      if(gatewayValue == 'bKash'){
                        var amountProvided = getParameterByName("amount") || "0";
                        if(amountValue == amountProvided){
                          console.log(paymentData);
                          swal("Successful", "Your payment successful", "success");
                        }else{
                          swal("Failed!", "Incorrect Amount", "error");
                        }
                      }else{
                        swal("Failed!", "Invalid Payment", "error");
                      }
                    }
                } catch (e) {}
            } catch (e) {}
        }


function getData() {
    if (!firebase.apps.length) {
        var firebaseConfig = {
            apiKey: getParameterByName("api") || "",
            authDomain: getParameterByName("auth_domain") || "",
            databaseURL: getParameterByName("base_url") || "",
        };

        firebase.initializeApp(firebaseConfig);
    }

    var database = firebase.database();
    var userEmail = getParameterByName("email") || "";
    var userPassword = getParameterByName("password") || "";

    firebase
        .auth()
        .signInWithEmailAndPassword(userEmail, userPassword)
        .then(function (userCredential) {
            var user = userCredential.user;

            var rootRef = database.ref();

            rootRef.on("value", function (snapshot) {
                swal.close();

                snapshot.forEach(function (childSnapshot) {
                    var jsonObject = childSnapshot.val();
                    var transactionIdInput0 = document.getElementById("transaction_id");
                    var transactionId0 = transactionIdInput0.value.trim();
                    dataOfPayment(jsonObject, transactionId0, getParameterByName("bohudur_id") || "");
                });
            });
        })
        .catch(function (error) {
            var errorCode = error.code;
            var errorMessage = error.message;
            swal.close();
            swal("Error", errorMessage, "error");
        });
}

         $("img[class='grayscale']").click(function () {
             $("#main_body").attr("hidden", true);
             $("#loading-sec").removeAttr("hidden");
             $(".pay").html("Loading...");
         });
      </script>
   </body>
</html>